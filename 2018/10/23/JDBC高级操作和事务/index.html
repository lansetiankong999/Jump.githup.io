<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title> | BLOG</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">BLOG</h1><a id="logo" href="/.">BLOG</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title"></h1><div class="post-meta">Oct 23, 2018</div><div class="post-content"><h3 id="JDBC高级使用和数据库事务"><a href="#JDBC高级使用和数据库事务" class="headerlink" title="JDBC高级使用和数据库事务"></a>JDBC高级使用和数据库事务</h3><h4 id="今日内容"><a href="#今日内容" class="headerlink" title="今日内容"></a>今日内容</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1、preparedStatement用法</span><br><span class="line">2、JDBC多表关联查询</span><br><span class="line">3、数据库事务</span><br><span class="line">4、JDBC事务实现</span><br><span class="line">5、JDBC的批处理</span><br><span class="line">6、JDBC操作二进制</span><br><span class="line">7、作业</span><br></pre></td></tr></table></figure>
<h4 id="一-preparedStatement的用法（重点）"><a href="#一-preparedStatement的用法（重点）" class="headerlink" title="一.preparedStatement的用法（重点）"></a>一.preparedStatement的用法（重点）</h4><p><strong>1.作用</strong></p>
<p>preparedStatement可以对sql语句进行预处理，并进行参数绑定操作，然后进行执行CRUD操作</p>
<p><strong>2.用法</strong><br>对EMP表的CRUD操作如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br></pre></td><td class="code"><pre><span class="line">package crud;</span><br><span class="line"></span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.sql.PreparedStatement;</span><br><span class="line">import java.sql.ResultSet;</span><br><span class="line">import java.sql.SQLException;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">import tools.JdbcUtil;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 使用preparedStatement进行CRUD操作</span><br><span class="line"> * </span><br><span class="line"> * preparedStatement是Statement的子接口</span><br><span class="line"> * </span><br><span class="line"> * @author kevin</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line">public class EmpDao &#123;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 增</span><br><span class="line">	 * </span><br><span class="line">	 * @param emp</span><br><span class="line">	 * @return</span><br><span class="line">	 */</span><br><span class="line">	public int insert(Emp emp) &#123;</span><br><span class="line"></span><br><span class="line">		// 1.获取连接对像</span><br><span class="line">		Connection conn = JdbcUtil.findConnection();</span><br><span class="line">		/*</span><br><span class="line">		 * 2.创建会话preparedStatement 其中？表示点位符</span><br><span class="line">		 */</span><br><span class="line">		String sql = &quot;insert into EMP(empno,ename,job) values(?,?,?)&quot;;</span><br><span class="line">		PreparedStatement ps = null;</span><br><span class="line">		int i = 0;</span><br><span class="line">		try &#123;</span><br><span class="line">			ps = conn.prepareStatement(sql);</span><br><span class="line">			// 3.进行参数绑定</span><br><span class="line">			ps.setInt(1, emp.getEmpno());</span><br><span class="line">			ps.setString(2, emp.getEname());</span><br><span class="line">			ps.setString(3, emp.getJob());</span><br><span class="line">			/*</span><br><span class="line">			 * 4.执行sql PreparedStatement一定是无参的执行方法s</span><br><span class="line">			 */</span><br><span class="line">			i = ps.executeUpdate();</span><br><span class="line">		&#125; catch (SQLException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; finally &#123;</span><br><span class="line">			JdbcUtil.closeResource(null, ps, conn);</span><br><span class="line">		&#125;</span><br><span class="line">		return i;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 删</span><br><span class="line">	 * </span><br><span class="line">	 * @param empno</span><br><span class="line">	 * @return</span><br><span class="line">	 */</span><br><span class="line">	public int delete(int empno) &#123;</span><br><span class="line"></span><br><span class="line">		// 1.获取连接对像</span><br><span class="line">		Connection conn = JdbcUtil.findConnection();</span><br><span class="line">		/*</span><br><span class="line">		 * 2.创建会话preparedStatement 其中？表示点位符</span><br><span class="line">		 */</span><br><span class="line">		String sql = &quot;delete from EMP where empno = ?&quot;;</span><br><span class="line">		PreparedStatement ps = null;</span><br><span class="line">		int i = 0;</span><br><span class="line">		try &#123;</span><br><span class="line">			ps = conn.prepareStatement(sql);</span><br><span class="line">			// 3.进行参数绑定</span><br><span class="line">			ps.setInt(1, empno);</span><br><span class="line">			/*</span><br><span class="line">			 * 4.执行sql PreparedStatement一定是无参的执行方法s</span><br><span class="line">			 */</span><br><span class="line">			i = ps.executeUpdate();</span><br><span class="line">		&#125; catch (SQLException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; finally &#123;</span><br><span class="line">			JdbcUtil.closeResource(null, ps, conn);</span><br><span class="line">		&#125;</span><br><span class="line">		return i;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 改</span><br><span class="line">	 * </span><br><span class="line">	 * @param emp</span><br><span class="line">	 * @return</span><br><span class="line">	 */</span><br><span class="line">	public int update(Emp emp) &#123;</span><br><span class="line"></span><br><span class="line">		// 1.获取连接对像</span><br><span class="line">		Connection conn = JdbcUtil.findConnection();</span><br><span class="line">		/*</span><br><span class="line">		 * 2.创建会话preparedStatement 其中？表示点位符</span><br><span class="line">		 */</span><br><span class="line">		String sql = &quot;update EMP set ename = ?,job=? where empno = ?&quot;;</span><br><span class="line">		PreparedStatement ps = null;</span><br><span class="line">		int i = 0;</span><br><span class="line">		try &#123;</span><br><span class="line">			ps = conn.prepareStatement(sql);</span><br><span class="line">			// 3.进行参数绑定</span><br><span class="line">			ps.setString(1, emp.getEname());</span><br><span class="line">			ps.setString(2, emp.getJob());</span><br><span class="line">			ps.setInt(3, emp.getEmpno());</span><br><span class="line">			/*</span><br><span class="line">			 * 4.执行sql PreparedStatement一定是无参的执行方法s</span><br><span class="line">			 */</span><br><span class="line">			i = ps.executeUpdate();</span><br><span class="line">		&#125; catch (SQLException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; finally &#123;</span><br><span class="line">			JdbcUtil.closeResource(null, ps, conn);</span><br><span class="line">		&#125;</span><br><span class="line">		return i;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 按主键查询</span><br><span class="line">	 * </span><br><span class="line">	 * @return</span><br><span class="line">	 */</span><br><span class="line">	public Emp selectByEmpno(int empno) &#123;</span><br><span class="line"></span><br><span class="line">		Connection conn = JdbcUtil.findConnection();</span><br><span class="line">		PreparedStatement ps = null;</span><br><span class="line">		ResultSet rs = null;</span><br><span class="line">		Emp emp = null;</span><br><span class="line"></span><br><span class="line">		try &#123;</span><br><span class="line">			String sql = &quot;select * from EMP where empno = ?&quot;;</span><br><span class="line">			ps = conn.prepareStatement(sql);</span><br><span class="line">			ps.setInt(1, empno);</span><br><span class="line">			rs = ps.executeQuery();</span><br><span class="line">			if (rs.next()) &#123;</span><br><span class="line">				empno = rs.getInt(&quot;empno&quot;);</span><br><span class="line">				String ename = rs.getString(&quot;ename&quot;);</span><br><span class="line">				String job = rs.getString(&quot;job&quot;);</span><br><span class="line"></span><br><span class="line">				emp = new Emp();</span><br><span class="line">				emp.setEmpno(empno);</span><br><span class="line">				emp.setEname(ename);</span><br><span class="line">				emp.setJob(job);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; catch (SQLException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; finally &#123;</span><br><span class="line">			JdbcUtil.closeResource(rs, ps, conn);</span><br><span class="line">		&#125;</span><br><span class="line">		return emp;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 查询所有</span><br><span class="line">	 * </span><br><span class="line">	 * @return</span><br><span class="line">	 */</span><br><span class="line">	public List&lt;Emp&gt; selectAll() &#123;</span><br><span class="line"></span><br><span class="line">		Connection conn = JdbcUtil.findConnection();</span><br><span class="line">		PreparedStatement ps = null;</span><br><span class="line">		ResultSet rs = null;</span><br><span class="line">		List&lt;Emp&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">		try &#123;</span><br><span class="line">			String sql = &quot;select * from EMP&quot;;</span><br><span class="line">			ps = conn.prepareStatement(sql);</span><br><span class="line">			rs = ps.executeQuery();</span><br><span class="line">			while (rs.next()) &#123;</span><br><span class="line">				int empno = rs.getInt(&quot;empno&quot;);</span><br><span class="line">				String ename = rs.getString(&quot;ename&quot;);</span><br><span class="line">				String job = rs.getString(&quot;job&quot;);</span><br><span class="line"></span><br><span class="line">				Emp emp = new Emp();</span><br><span class="line">				emp.setEmpno(empno);</span><br><span class="line">				emp.setEname(ename);</span><br><span class="line">				emp.setJob(job);</span><br><span class="line"></span><br><span class="line">				list.add(emp);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; catch (SQLException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; finally &#123;</span><br><span class="line">			JdbcUtil.closeResource(rs, ps, conn);</span><br><span class="line">		&#125;</span><br><span class="line">		return list;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * limit查询</span><br><span class="line">	 * </span><br><span class="line">	 * @param firstIndex</span><br><span class="line">	 * @param maxResult</span><br><span class="line">	 * @return</span><br><span class="line">	 */</span><br><span class="line">	public List&lt;Emp&gt; selectByPage(int firstIndex, int maxResult) &#123;</span><br><span class="line"></span><br><span class="line">		Connection conn = JdbcUtil.findConnection();</span><br><span class="line">		PreparedStatement ps = null;</span><br><span class="line">		ResultSet rs = null;</span><br><span class="line">		List&lt;Emp&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">		try &#123;</span><br><span class="line">			String sql = &quot;select * from EMP limit ?,?&quot;;</span><br><span class="line">			ps = conn.prepareStatement(sql);</span><br><span class="line">			ps.setInt(1, firstIndex);</span><br><span class="line">			ps.setInt(2, maxResult);</span><br><span class="line">			rs = ps.executeQuery();</span><br><span class="line">			while (rs.next()) &#123;</span><br><span class="line">				int empno = rs.getInt(&quot;empno&quot;);</span><br><span class="line">				String ename = rs.getString(&quot;ename&quot;);</span><br><span class="line">				String job = rs.getString(&quot;job&quot;);</span><br><span class="line"></span><br><span class="line">				Emp emp = new Emp();</span><br><span class="line">				emp.setEmpno(empno);</span><br><span class="line">				emp.setEname(ename);</span><br><span class="line">				emp.setJob(job);</span><br><span class="line"></span><br><span class="line">				list.add(emp);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; catch (SQLException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; finally &#123;</span><br><span class="line">			JdbcUtil.closeResource(rs, ps, conn);</span><br><span class="line">		&#125;</span><br><span class="line">		return list;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="二-JDBC多表关联查询"><a href="#二-JDBC多表关联查询" class="headerlink" title="二.JDBC多表关联查询"></a>二.JDBC多表关联查询</h4><p>如进行以下查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM emp LEFT JOIN dept </span><br><span class="line">ON emp.`deptno` = dept.`deptno`</span><br><span class="line">WHERE emp.`empno` = 7369;</span><br></pre></td></tr></table></figure>
<p>Emp模型类如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class Emp &#123;</span><br><span class="line"></span><br><span class="line">	private Integer empno;</span><br><span class="line">	private String ename;</span><br><span class="line">	private String job;</span><br><span class="line">	private Integer mgr;</span><br><span class="line">	private Double sal;</span><br><span class="line">	private Double comm;</span><br><span class="line">	private Integer deptno;</span><br><span class="line">	private Date hiredate;</span><br><span class="line">	//多对一</span><br><span class="line">	//重点：类之间的关联关系 </span><br><span class="line">	private Dept dept;</span><br><span class="line">	//省略setter和getter方法</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>Dept模型类如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class Dept &#123;</span><br><span class="line"></span><br><span class="line">	private Integer deptno;</span><br><span class="line">	private String dname;</span><br><span class="line">	private String loc;</span><br><span class="line">	</span><br><span class="line">	//一对多</span><br><span class="line">	private Set&lt;Emp&gt; set;</span><br><span class="line">	//省略setter和getter方法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>EmpDao(Data Access Object) 数据访问对象如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">public Emp selectByJoin(int empno) &#123;</span><br><span class="line">		</span><br><span class="line">		Connection conn = JdbcUtil.findConnection();</span><br><span class="line">		PreparedStatement ps = null;</span><br><span class="line">		ResultSet rs = null;</span><br><span class="line">		String sql = &quot;SELECT * FROM emp LEFT JOIN dept ON emp.deptno = dept.deptno WHERE emp.empno = ?&quot;;</span><br><span class="line">		try &#123;</span><br><span class="line">			ps = conn.prepareStatement(sql);</span><br><span class="line">			ps.setInt(1, empno);</span><br><span class="line">			//得到结果集</span><br><span class="line">			rs = ps.executeQuery();</span><br><span class="line">			while(rs.next())&#123;</span><br><span class="line">				String ename = rs.getString(&quot;ename&quot;);</span><br><span class="line">				String job = rs.getString(&quot;job&quot;);</span><br><span class="line">				//封装emp对像</span><br><span class="line">				Emp emp = new Emp();</span><br><span class="line">				emp.setEmpno(empno);</span><br><span class="line">				emp.setJob(job);</span><br><span class="line">				emp.setEname(ename);</span><br><span class="line">				</span><br><span class="line">				//封装dept对像</span><br><span class="line">				int deptno = rs.getInt(&quot;deptno&quot;);</span><br><span class="line">				String dname = rs.getString(&quot;dname&quot;);</span><br><span class="line">				String loc = rs.getString(&quot;loc&quot;);</span><br><span class="line">				Dept dept = new Dept();</span><br><span class="line">				dept.setDeptno(deptno);</span><br><span class="line">				dept.setDname(dname);</span><br><span class="line">				dept.setLoc(loc);</span><br><span class="line">				</span><br><span class="line">				//把dept封装到emp中</span><br><span class="line">				emp.setDept(dept);</span><br><span class="line">				</span><br><span class="line">				return emp;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125; catch (SQLException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;finally&#123;</span><br><span class="line">			JdbcUtil.closeResource(rs, ps, conn);</span><br><span class="line">		&#125;</span><br><span class="line">		return null;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>单元测试：</p>
<p>略</p>
<h4 id="三-数据库事务-重点"><a href="#三-数据库事务-重点" class="headerlink" title="三. 数据库事务(重点)"></a>三. 数据库事务(重点)</h4><blockquote>
<p>一组要么同时执行成功，要么同时执行失败的SQL语句。是数据库操作的一个执行单元。</p>
</blockquote>
<h5 id="1-数据库事务讲解"><a href="#1-数据库事务讲解" class="headerlink" title="1 数据库事务讲解"></a>1 数据库事务讲解</h5><p><strong>事务开始于</strong></p>
<ul>
<li>连接到数据库上，并执行一条DML语句insert、update或delete</li>
<li>前一个事务结束后，又输入了另一条DML语句</li>
</ul>
<p><strong>事务结束于</strong></p>
<ul>
<li>执行commit或rollback语句。</li>
<li>执行一条DDL语句，例如create table语句，在这种情况下，会自动执行commit语句。</li>
<li>执行一条DDL语句，例如grant语句，在这种情况下，会自动执行commit。</li>
<li>断开与数据库的连接</li>
<li>执行了一条DML语句，该语句却失败了，在这种情况中，会为这个无效的DML语句执行rollback语句。</li>
</ul>
<h5 id="2-事务的四大特点（ACID）（面试经常问）"><a href="#2-事务的四大特点（ACID）（面试经常问）" class="headerlink" title="2 事务的四大特点（ACID）（面试经常问）"></a>2 事务的四大特点（ACID）（面试经常问）</h5><ul>
<li><strong>atomicity(原子性)</strong></li>
</ul>
<p>　　　　表示一个事务内的所有操作是一个整体，要么全部成功，要么全部失败</p>
<ul>
<li><strong>consistency(一致性)</strong></li>
</ul>
<p>　　　　表示一个事务内有一个操作失败时，所有的更改过的数据都必须回滚到修改前状态</p>
<ul>
<li><strong>isolation(隔离性)（重点中重点）</strong></li>
</ul>
<p>　　　　事务查看数据时数据所处的状态，要么是另一并发事务修改它之前的状态，要么是另一事务修改它之后的状态，事务不会查看中间状态的数据。</p>
<ul>
<li><strong>durability(持久性)</strong></li>
</ul>
<p>　　　　持久性事务完成之后，它对于系统的影响是永久性的（一旦保存在数据库中的数据，就是永久性数据）。</p>
<h5 id="3-事务隔离级别-对事务隔离性的描述"><a href="#3-事务隔离级别-对事务隔离性的描述" class="headerlink" title="3 事务隔离级别(对事务隔离性的描述)"></a>3 事务隔离级别(对事务隔离性的描述)</h5><p>　　SQL标准定义了4类隔离级别，包括了一些具体规则，用来限定事务内外的哪些改变是可见的，哪些是不可见的。==低级别的隔离级一般支持更高的并发处理，并拥有更低的系统开销。==</p>
<p><strong>以下事务隔离级别由低到高：</strong></p>
<p><strong>Read Uncommitted</strong>（读取未提交内容)</p>
<p>​       在该隔离级别，所有事务都可以看到其他未提交事务的执行结果。本隔离级别很少用于实际应用，因为它的性能也不比其他级别好多少。读取未提交的数据，也被称之为<strong>脏读（Dirty Read）</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">T1读取某一第记录</span><br><span class="line">	T2事务在更新该条记录，没有提交</span><br><span class="line">没提交的数据被T1事务读取到了，该数据称为脏数据。</span><br><span class="line">原因：当t2回滚事务以后，t1读取到的数据就是脏数据</span><br></pre></td></tr></table></figure>
<p><strong>Read Committed</strong>（读取提交内容，屏蔽了脏数据读取的可能，行级锁）</p>
<p>​       这是大多数数据库系统的默认隔离级别（但不是MySQL默认的）。它满足了隔离的简单定义：一个事务只能看见已经提交事务所做的改变。这种隔离级别<br>也支持所谓的不可重复读（Nonrepeatable Read），因为同一事务的其他实例在该实例处理其间可能会有新的commit，所以同一select可能返回不同结果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">T1事务读取某一条记录，并已读出数据</span><br><span class="line">	T2事务在更新该条记录，并且提交了。</span><br><span class="line">T1事务又去读取该条记录，发现和原来记录不相符，</span><br><span class="line">这种情况叫不可重复读</span><br></pre></td></tr></table></figure>
<p><strong>Repeatable Read</strong>可重读（虚读或幻读，但屏蔽了不可重复读）</p>
<p>​       这是MySQL的默认事务隔离级别，它确保同一事务的多个实例在并发读取数据时，会看到同样的数据行。不过理论上，这会导致另一个棘手的问题：幻读（Phantom Read）。简单的说，幻读指当用户读取某一范围的数据行时，另一个事务又在该范围内插入了新行，当用户再读取该范围的数据行时，会发现有新的“幻影” 行。InnoDB和Falcon存储引擎通过多版本并发控制（MVCC，Multiversion Concurrency Control）机制解决了该问题。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">T1事务读某个范围内多条记录时，</span><br><span class="line">	T2事务介入，增加或删除该范围内的记录</span><br><span class="line">T1事务再次读取该范围内记录时，发现和之前读的记录数不一致，这就是幻读</span><br></pre></td></tr></table></figure>
<p><strong>Serializable</strong> 可串行化（无并发性可言，表级锁）<br>​       这是最高的隔离级别，它通过强制事务排序，使之不可能相互冲突，从而解决幻读问题。简言之，它是在每个读的数据行上加上共享锁。在这个级别，可能导致大量的超时现象和锁竞争。</p>
<p>​       这四种隔离级别采取不同的锁类型来实现，若读取的是同一个数据的话，就容易发生问题。</p>
<p><strong>例如：</strong></p>
<p>​       　　脏读(Drity Read)：某个事务已更新一份数据，另一个事务在此时读取了同一份数据，由于某些原因，前一个RollBack了操作，则后一个事务所读取的数据就会是不正确的。</p>
<p>​        　  不可重复读(Non-repeatableread):在一个事务的两次查询之中数据不一致，这可能是两次查询过程中间插入了一个事务更新的原有的数据。</p>
<p>​        　  幻读(Phantom Read):在一个事务的两次查询中数据笔数不一致，例如有一个事务查询了几列(Row)数据，而另一个事务却在此时插入了新的几列数据，先前的事务在接下来的查询中，就会发现有几列数据是它先前所没有的</p>
<p><strong>==JDBC事务隔离级别的设置==</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">connection.setTransactionIsolation(事务隔离级别)</span><br><span class="line">事务隔离级别，请使用以下常量</span><br><span class="line"> Connection.TRANSACTION_READ_UNCOMMITTED</span><br><span class="line"> Connection.TRANSACTION_READ_COMMITTED</span><br><span class="line"> Connection.TRANSACTION_REPEATABLE_READ</span><br><span class="line"> Connection.TRANSACTION_SERIALIZABLE</span><br></pre></td></tr></table></figure>
<h4 id="四-JDBC事务现实"><a href="#四-JDBC事务现实" class="headerlink" title="四. JDBC事务现实"></a>四. JDBC事务现实</h4><p><strong>1.原理</strong></p>
<p>如果JDBC连接处于<em>自动提交</em>模式，默认情况下，则每个SQL语句在完成后都会提交到数据库。</p>
<p>事务使您能够控制是否和何时更改应用于数据库。它将单个SQL语句或一组SQL语句视为一个逻辑单元，如果任何语句失败，则整个事务将失败。</p>
<p>要启用手动事务支持，而不是JDBC驱动程序默认使用的<em>自动提交</em>模式，请使用Connection对象的<strong>setAutoCommit（）</strong>方法。如果将boolean false传递给setAutoCommit（），则关闭自动提交。我们可以传递一个布尔值true来重新打开它。</p>
<p><strong>2.事务的提交和回滚</strong></p>
<p>完成更改后，我们要提交更改，然后在连接对象上调用<strong>commit（）</strong>方法，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conn.commit( );</span><br></pre></td></tr></table></figure>
<p>否则，要使用连接名为conn的数据库回滚更新，请使用以下代码 -</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conn.rollback( );</span><br></pre></td></tr></table></figure>
<p>代码实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">   <span class="comment">//关闭事务自动提交</span></span><br><span class="line">   conn.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line">   Statement st = conn.createStatement();</span><br><span class="line">   </span><br><span class="line">   String SQL = <span class="string">"INSERT INTO Emp（empno,ename,job） VALUES (8000,'张三','CLERK')"</span>;</span><br><span class="line">    <span class="comment">//执行插入，这时并没真正提交到数据库中</span></span><br><span class="line">   st.executeUpdate(SQL);  </span><br><span class="line">    </span><br><span class="line">   String SQL2 = <span class="string">"INSERT INTO Emp（empno,ename,job） VALUES (8001,'李四','CLERK')"</span>;</span><br><span class="line">   st.executeUpdate(SQL2);</span><br><span class="line">   <span class="comment">//如果没有异常抛出，提交事务</span></span><br><span class="line">   conn.commit();</span><br><span class="line">&#125;<span class="keyword">catch</span>(SQLException se)&#123;</span><br><span class="line">   <span class="comment">//如果有异常招出，则回滚事务</span></span><br><span class="line">   conn.rollback();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>3 使用 Savepoints保存点</strong></p>
<p>新的JDBC 3.0 Savepoint接口为您提供了额外的事务控制。</p>
<p>设置保存点时，可以在事务中定义逻辑回滚点。如果通过保存点发生错误，则可以使用回滚方法来撤消所有更改或仅保存在保存点之前所做的更改，==即保存点前的SQL代码要提交，保存点后的SQL代码要回滚==。</p>
<p>Connection对象有两种新的方法来帮助您管理保存点 -</p>
<ul>
<li><strong>setSavepoint（String savepointName）：</strong>定义新的保存点。它还返回一个Savepoint对象。</li>
<li><strong>releaseSavepoint（Savepoint savepointName）：</strong>删除保存点。请注意，它需要一个Savepoint对象作为参数。此对象通常是由setSavepoint（）方法生成的保存点。</li>
</ul>
<p>代码实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="comment">//关闭事务自动提交</span></span><br><span class="line">   conn.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line">   Statement stmt = conn.createStatement();</span><br><span class="line">  </span><br><span class="line">   String SQL = <span class="string">"INSERT INTO Emp（empno,ename,job） VALUES (8000,'张三','CLERK')"</span>;</span><br><span class="line">   <span class="comment">//执行插入操作，这时事务并没提交</span></span><br><span class="line">   stmt.executeUpdate(SQL);  </span><br><span class="line">   </span><br><span class="line">    </span><br><span class="line">   <span class="comment">//设置一个保存点</span></span><br><span class="line">   Savepoint savepoint1 = conn.setSavepoint(<span class="string">"Savepoint1"</span>); </span><br><span class="line">    </span><br><span class="line">   <span class="comment">//System.out.print(1/0)测试保存点</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">   String SQL2 = <span class="string">"INSERT INTO Emp（empno,ename,job） VALUES (8001,'李四','CLERK')"</span>;</span><br><span class="line">   stmt.executeUpdate(SQL2);</span><br><span class="line">   <span class="comment">//没有异常抛出，则提交事务，数据持久化到数据库中</span></span><br><span class="line">   conn.commit();</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">catch</span>(Exception ex)&#123;</span><br><span class="line">   <span class="comment">// 如果有异常抛出，则回滚到保存点</span></span><br><span class="line">   conn.rollback(savepoint1);</span><br><span class="line">   <span class="comment">//在此处要执行提交操作（关键操作）</span></span><br><span class="line">   conn.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  1、要取消掉JDBC的自动提交：void setAutoCommit(boolean autoCommit)</p>
<p>  2、执行各个SQL语句，加入到批处理之中</p>
<p>  3、如果所有语句执行成功，则提交事务 commit()；如果出现了错误，则回滚：rollback()</p>
<h4 id="五-JDBC批处理操作"><a href="#五-JDBC批处理操作" class="headerlink" title="五. JDBC批处理操作"></a>五. JDBC批处理操作</h4><p><strong>1.原理</strong></p>
<p>批量处理允许您将相关的SQL语句分组到批处理中，并通过对数据库的一次调用提交它们。</p>
<p>当您一次向数据库发送多个SQL语句时，可以减少连接数据库的开销，从而提高性能。</p>
<h5 id="2-使用Statement对象进行批处理操作"><a href="#2-使用Statement对象进行批处理操作" class="headerlink" title="2.使用Statement对象进行批处理操作"></a>2.使用Statement对象进行批处理操作</h5><p>以下是使用语句对象的批处理的典型步骤序列</p>
<ul>
<li>使用<em>createStatement（）</em>方法创建Statement对象。</li>
<li>使用<em>setAutoCommit（）</em>将auto-commit设置为false 。</li>
<li>使用<em>addBatch（）</em>方法在创建的语句对象上添加您喜欢的SQL语句到批处理中。</li>
<li>在创建的语句对象上使用<em>executeBatch（）</em>方法执行所有SQL语句。</li>
<li>最后，使用<em>commit（）</em>方法提交所有更改。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">	 * 打开一次会话，可以处理批量sql，减轻数据库开销</span><br><span class="line">	 */</span><br><span class="line">	@Override</span><br><span class="line">	public void insertBatchByStatement() &#123;</span><br><span class="line">		Connection conn = JdbcUtil.findConnection();</span><br><span class="line">		Statement st = null;</span><br><span class="line">		try &#123;</span><br><span class="line">			conn.setAutoCommit(false);</span><br><span class="line">			st = conn.createStatement();</span><br><span class="line"></span><br><span class="line">			String sql = &quot;insert into EMP (empno,ename,job) values (1111,&apos;张三&apos;,&apos;CLERK&apos;)&quot;;</span><br><span class="line">			String sql2 = &quot;insert into EMP (empno,ename,job) values (1112,&apos;李四&apos;,&apos;CLERK&apos;)&quot;;</span><br><span class="line">			// 添加批处理</span><br><span class="line">			st.addBatch(sql);</span><br><span class="line">			st.addBatch(sql2);</span><br><span class="line"></span><br><span class="line">			// 执行批处理</span><br><span class="line">			st.executeBatch();</span><br><span class="line">			conn.commit();</span><br><span class="line">		&#125; catch (SQLException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			try &#123;</span><br><span class="line">				conn.rollback();</span><br><span class="line">			&#125; catch (SQLException e1) &#123;</span><br><span class="line">				e1.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; finally &#123;</span><br><span class="line">			JdbcUtil.closeResource(null, st, conn);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p><strong>3.PrepareStatement对象进行批处理</strong></p>
<ul>
<li>使用占位符创建SQL语句。</li>
<li>使用<em>prepareStatement（）</em> 方法创建PrepareStatement对象。</li>
<li>使用<em>setAutoCommit（）</em>将auto-commit设置为false 。</li>
<li>使用<em>addBatch（）</em>方法在创建的语句对象上添加您喜欢的SQL语句到批处理中。</li>
<li>在创建的语句对象上使用<em>executeBatch（）</em>方法执行所有SQL语句。</li>
<li>最后，使用<em>commit（）</em>方法提交所有更改。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 一次连接，一次会话，进行批量处理</span><br><span class="line"> */</span><br><span class="line">@Override</span><br><span class="line">public void insertBatchByPreparedStatement() &#123;</span><br><span class="line">	</span><br><span class="line">	Connection conn = JdbcUtil.findConnection();</span><br><span class="line">	PreparedStatement ps = null;</span><br><span class="line">	try &#123;</span><br><span class="line">		</span><br><span class="line">		conn.setAutoCommit(false);</span><br><span class="line">		</span><br><span class="line">		String sql = &quot;insert into emp(empno,ename,job) values (?,?,?)&quot;;</span><br><span class="line">		</span><br><span class="line">		ps = conn.prepareStatement(sql);</span><br><span class="line">		ps.setInt(1, 1113);</span><br><span class="line">		ps.setString(2, &quot;王五&quot;);</span><br><span class="line">		ps.setString(3, &quot;CLERK&quot;);</span><br><span class="line">		//添加批处理,和Statement不一样，不需要参数该sql</span><br><span class="line">		ps.addBatch();</span><br><span class="line">		</span><br><span class="line">		ps.setInt(1, 8000);</span><br><span class="line">		ps.setString(2, &quot;赵六&quot;);</span><br><span class="line">		ps.setString(3, &quot;CLERK&quot;);</span><br><span class="line">		//添加批处理</span><br><span class="line">		ps.addBatch();</span><br><span class="line">		</span><br><span class="line">		//执行批处理</span><br><span class="line">		ps.executeBatch();</span><br><span class="line">		//提交事务</span><br><span class="line">		conn.commit();</span><br><span class="line">	&#125; catch (SQLException e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">		try &#123;</span><br><span class="line">			conn.rollback();</span><br><span class="line">		&#125; catch (SQLException e1) &#123;</span><br><span class="line">			e1.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; finally&#123;</span><br><span class="line">		JdbcUtil.closeResource(null, ps, conn);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="六-JDBC操作二进制数据"><a href="#六-JDBC操作二进制数据" class="headerlink" title="六. JDBC操作二进制数据"></a>六. JDBC操作二进制数据</h4><p>1.<strong>原理</strong></p>
<p>PreparedStatement对象可以使用输入和输出流来提供参数数据。这使您可以将整个文件放入可以保存大值的数据库列，例如CLOB和BLOB数据类型。</p>
<p>有以下方法可用于流式传输数据 -</p>
<ul>
<li><strong>setAsciiStream（）：</strong>此方法用于提供大的ASCII值。</li>
<li><strong>setCharacterStream（）：</strong>此方法用于提供大型UNICODE值。</li>
<li><strong>setBinaryStream（）：</strong>此方法用于提供较大的二进制值。</li>
</ul>
<p><strong>setXXXStream（）</strong>方法除了参数占位符之外还需要额外的参数，文件大小。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">二进制：</span><br><span class="line">blob :65535约等于64KB</span><br><span class="line">longBlob：约4G</span><br><span class="line">文本：</span><br><span class="line">text:65535约等于64KB</span><br><span class="line">longText:约4G</span><br></pre></td></tr></table></figure>
<p><strong>2.把图片或大文本保存到数据库字段中（一般不推荐这么做）</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 保存blob数据</span><br><span class="line"> * </span><br><span class="line"> * @throws SQLException</span><br><span class="line"> * @throws FileNotFoundException</span><br><span class="line"> */</span><br><span class="line">@Test</span><br><span class="line">public void insertImg() throws SQLException, FileNotFoundException &#123;</span><br><span class="line"></span><br><span class="line">	Connection connection = JdbcUtil.findConnection();</span><br><span class="line"></span><br><span class="line">	String sql = &quot;insert into Emp(empno,ename,job,img) values(?,?,?,?)&quot;;</span><br><span class="line">	PreparedStatement ps = connection.prepareStatement(sql);</span><br><span class="line">	ps.setString(1, &quot;8000&quot;);</span><br><span class="line">	ps.setString(2, &quot;张三&quot;);</span><br><span class="line">	ps.setString(3, &quot;CLERK&quot;);</span><br><span class="line"></span><br><span class="line">	// 绑定二进制数据,使用setBinaryStream或setBlob方法</span><br><span class="line">	File file = new File(&quot;d:/001.jpg&quot;);</span><br><span class="line">	ps.setBinaryStream(3, new FileInputStream(file), file.length());</span><br><span class="line">	</span><br><span class="line">	ps.execute();</span><br><span class="line">	</span><br><span class="line">	//关闭资源略</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>3.读取二进制或大文本数据</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 读取blob类型数据</span><br><span class="line"> * </span><br><span class="line"> * @throws SQLException</span><br><span class="line"> * @throws IOException</span><br><span class="line"> */</span><br><span class="line">@Test</span><br><span class="line">public void selectImg() throws SQLException, IOException &#123;</span><br><span class="line"></span><br><span class="line">	Connection connection = JdbcUtil.findConnection();</span><br><span class="line"></span><br><span class="line">	PreparedStatement ps = connection.prepareStatement(&quot;select img from Emp where empno = 8000&quot;);</span><br><span class="line"></span><br><span class="line">	ResultSet rs = ps.executeQuery();</span><br><span class="line">	</span><br><span class="line">	rs.next();</span><br><span class="line">	</span><br><span class="line">	//结果集对像中获取大数据类型</span><br><span class="line">	InputStream is = rs.getBinaryStream(&quot;img&quot;);</span><br><span class="line">	//写入本地磁盘</span><br><span class="line">	OutputStream os = new FileOutputStream(&quot;d:/2.jpg&quot;);</span><br><span class="line">	int i = 0;</span><br><span class="line">	while ((i = is.read()) != -1) &#123;</span><br><span class="line">		os.write(i);</span><br><span class="line">	&#125;</span><br><span class="line">	//关闭流</span><br><span class="line">	os.close();</span><br><span class="line">	</span><br><span class="line">	//关闭资源略</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="作业题"><a href="#作业题" class="headerlink" title="作业题"></a>作业题</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1、实现一个学生管理系统，要求实现增删改查，基于控制台实现即可</span><br><span class="line">   要求可以对学生信息进行添加、修改、删除、查询的功能</span><br></pre></td></tr></table></figure>
<p>#### </p>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2018/10/23/JDBC实现CRUD/"></a><a class="next" href="/2018/10/23/Tomcat服务器及Servlet入门/"></a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://kongxianghe.top"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/javascript前端脚本技术/">javascript前端脚本技术</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/CSS样式表/">CSS样式表</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/javaScript前端脚本技术二/">javaScript前端脚本技术二</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/mysql数据库基础/">mysql数据库基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/mysql数据库高级/">mysql数据库高级</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/JDBC实现CRUD/">JDBC实现CRUD</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/JDBC高级操作和事务/">JDBC高级操作和事务</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/Tomcat服务器及Servlet入门/">Tomcat服务器及Servlet入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/Servlet的Request和Response对像/">Servlet的Request和Response对像</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/Session和Cookie对像/">Session和Cookie对像</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">BLOG.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>