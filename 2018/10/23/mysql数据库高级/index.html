<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title> | BLOG</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">BLOG</h1><a id="logo" href="/.">BLOG</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title"></h1><div class="post-meta">Oct 23, 2018</div><div class="post-content"><h1 id="Mysql数据库高查询"><a href="#Mysql数据库高查询" class="headerlink" title="Mysql数据库高查询"></a>Mysql数据库高查询</h1><p><strong>今日内容</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1、SQL语言数据的完整性</span><br><span class="line">	实体完整性</span><br><span class="line">	域完整性</span><br><span class="line">	引用完整性</span><br><span class="line">2、多表关联查询</span><br><span class="line">	概念</span><br><span class="line">	表关系分类</span><br><span class="line">	联合查询</span><br><span class="line">	隐式内连接查询</span><br><span class="line">	显示内连接查询</span><br><span class="line">	外连接查询</span><br><span class="line">	自连接查询</span><br><span class="line">	三表以上关联查询</span><br><span class="line">3、子查询</span><br><span class="line">	概念</span><br><span class="line">	用法</span><br><span class="line">4、视图</span><br><span class="line">	概念</span><br><span class="line">	用法</span><br><span class="line">5、了解SQL优化</span><br><span class="line">6、作业</span><br></pre></td></tr></table></figure>
<p><strong>一.SQL语言数据的完整性</strong></p>
<p>作用：保证用户输入的数据保存到数据库中是正确的。</p>
<p>注意：确保数据的完整性 最好在创建表时或表中无数据时给表中添加约束</p>
<p>数据完整性分类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- 实体完整性</span><br><span class="line">- 域完整性</span><br><span class="line">- 引用完整性</span><br></pre></td></tr></table></figure>
<ol>
<li><p>实体完整性</p>
<p>实体：即表中的一行(一条记录)代表一个实体（entity）</p>
<p>作用：标识每一行数据不重复。</p>
<p>约束类型：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">主键约束（primary key） </span><br><span class="line">唯一约束(unique)  </span><br><span class="line">自动增长列(auto_increment)</span><br></pre></td></tr></table></figure>
<p><strong>主键约束</strong>：每个表中要有一个主键（数据唯一，且不能为null）。</p>
<p>方式一：创建表时添加约束</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">create table user(</span><br><span class="line">id int(5) primary key,</span><br><span class="line">name varchar(20)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">create table user(</span><br><span class="line">id int(5),</span><br><span class="line">name varchar(20),</span><br><span class="line">primary key(id)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>方式二：创建表时添加联合主键约束</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table user(</span><br><span class="line">id int(5),</span><br><span class="line">name varchar(20),</span><br><span class="line">primary key(id,name)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>方式三：创建表后，添加约束</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">createa table user(</span><br><span class="line">id int(5),</span><br><span class="line">name varchar(20)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">alter table user add constraint 别名 primary key (id)</span><br><span class="line"></span><br><span class="line">alter table user add  primary key (id)</span><br></pre></td></tr></table></figure>
<p>删除主键约束</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 drop primary key</span><br></pre></td></tr></table></figure>
<p>​</p>
<p><strong>唯一性约束：</strong>数据不能重复</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table user(</span><br><span class="line">id int(5) primary key,</span><br><span class="line">name varchar(20) unique//唯一性约束</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><strong>主键自增(auto_increment)：</strong>给主键添加自动增长的数值，列只能是整数类型 </p>
<p>oracle 不支持主键自增，代替使用序列sequence</p>
<p>sqlserver 支持主键自增，关键字identity</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table user(</span><br><span class="line">id int(5) primary key auto_increment,//表示主键自增，该键数据库底层给于维护</span><br><span class="line">name varchar(20)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">//insert时，id值不需要给值</span><br><span class="line">insert into user (name) values(&apos;张三&apos;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>域完整性</p>
<p>作用：限制此单元格的数据正确，不对照此列的其它单元格比较</p>
<p>约束类型：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">数据类型 </span><br><span class="line">非空约束（not null） </span><br><span class="line">默认值约束(default)</span><br></pre></td></tr></table></figure>
<p><strong>数据类型</strong>：略</p>
<p><strong>非空约束：</strong>not null字段不能为空</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table user(</span><br><span class="line">id int(5) primary key auto_increment,</span><br><span class="line">name varchar(20) not null//非空约束</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><strong>默认值约束：</strong>    default给字段设置默认值，有值时不使用默认值，无值时使用默认值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">create table user(</span><br><span class="line">id int(5) primary key auto_increment,</span><br><span class="line">name varchar(20) not null default &apos;admin&apos;,</span><br><span class="line">age int(3)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO user7 (age) VALUES (20);</span><br><span class="line">INSERT INTO user7 (NAME,age) VALUES (&apos;张三&apos;,20);</span><br></pre></td></tr></table></figure>
</li>
<li><p>引用完整性</p>
<p>作用：多张表关联时，一般使用外键约束，FOREIGN KEY </p>
<p>约束类型：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">外键约束</span><br></pre></td></tr></table></figure>
<p><strong>外键约束：</strong></p>
<p>方式一：创建表时添加外键</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#先创建班级表class</span><br><span class="line">create table class(</span><br><span class="line">id int(5) primary key,</span><br><span class="line">cname varchar(20)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">#创建学生表stu,stu依赖于class的存在</span><br><span class="line">create table stu(</span><br><span class="line">id int(5) primary key,</span><br><span class="line">sname varchar(20),</span><br><span class="line">cid int(5),</span><br><span class="line">foreign key (cid) references class (id) //外键声明</span><br><span class="line">);</span><br><span class="line">注意：一般从表外键依赖主表的主键</span><br></pre></td></tr></table></figure>
<p>方式二：创建关联表后添加外键</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#因为外键声明是在创建表之后，所以表的创建可以没有次序</span><br><span class="line"></span><br><span class="line">create table stu(</span><br><span class="line">id int(5) primary key,</span><br><span class="line">sname varchar(20),</span><br><span class="line">cid int(5)</span><br><span class="line">）;</span><br><span class="line"></span><br><span class="line">create table class(</span><br><span class="line">id int(5) primary key,</span><br><span class="line">cname varchar(20)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">//外键声明</span><br><span class="line"></span><br><span class="line">alter table 表名 add constraint 别名 foreign key(外键) references 主表（主键）</span><br><span class="line"></span><br><span class="line">如：</span><br><span class="line">alter table stu add constraint fk_cid foreign key (cid) references class(id);</span><br></pre></td></tr></table></figure>
<p><strong>删除外键关系</strong>(通过别名删除)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 drop  foreign key 别名</span><br><span class="line">如：</span><br><span class="line">ALTER TABLE stu DROP FOREIGN KEY fk_cid;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>二.多表关联查询</strong>（重点）</p>
<ol>
<li><p>概念 </p>
<p>大部分的表和表之间总存在着外键关联关系，当查询一张表记录时，关联查询另一张表中的数据信息，称为表与表之间的关联查询。</p>
<ol start="2">
<li>表关系分类</li>
</ol>
<p><strong>一对一</strong>：表与表之的记录是一一对应的关系，比如学生和学生证关系属于一对一关系，公民信息表与身份证信息表也是一对一关系。</p>
<p><strong>一对多</strong>：表中一条记录对应另一张表的中多条记录。如班级和学生的关系就是一对多关系，即一个班级对应多条学生记录。</p>
<p><strong>多对多</strong>：表中多条记录对应着另一张表中的多条记录。如老师和学生，或学生和学科关系都属性多对多关系。</p>
<ol start="3">
<li>联合查询</li>
</ol>
<p>多张表之间的相同类型属性显示成一个结果集。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">union 联合</span><br><span class="line">union all 联合所有</span><br></pre></td></tr></table></figure>
<p>如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#union 把两相同类型数据显示成一列，注意：重复性记录只记录一条</span><br><span class="line">SELECT sal FROM emp </span><br><span class="line">UNION</span><br><span class="line">SELECT comm FROM emp;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#union all 把两相同类型数据显示成一列，注意：重复性记录都会显示</span><br><span class="line">SELECT sal FROM emp </span><br><span class="line">UNION ALL</span><br><span class="line">SELECT comm FROM emp;</span><br><span class="line"></span><br><span class="line">#不同表相的联合查询</span><br><span class="line">SELECT deptno FROM emp</span><br><span class="line">UNION ALL</span><br><span class="line">SELECT deptno FROM dept;</span><br><span class="line"></span><br><span class="line">#不同类型的列，不要联合查询</span><br></pre></td></tr></table></figure>
<p>4.隐式内连接查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#笛卡尔积</span><br><span class="line">该查询结果没有现实意义，以后多表查询不要出现笛卡尔积</span><br><span class="line">该查询的原理：一张表的一条记录乘以另一张表的记录，所得到机械的结果集</span><br></pre></td></tr></table></figure>
<p>如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#去除笛卡尔积中重复的部份，取等值部份（主键和外键相等的部份）</span><br><span class="line">SELECT * FROM emp,dept WHERE emp.`deptno` = dept.`deptno`;</span><br></pre></td></tr></table></figure>
</li>
<li><p>显示内连接查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[inner] join 显示内连接</span><br></pre></td></tr></table></figure>
<p>如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">select * from 表1 inner join 表2 on 连接条件</span><br><span class="line">select * from emp [inner] join dept on emp.deptno = dept.deptno;</span><br><span class="line"></span><br><span class="line">#查询7369号员工的姓名，薪水及所在的部门名称</span><br><span class="line"></span><br><span class="line">select ename,sal,dname from emp </span><br><span class="line">inner join dept </span><br><span class="line">on emp.deptno = dept.deptno </span><br><span class="line">where empno=7369;</span><br><span class="line"></span><br><span class="line">#也可以起别名</span><br><span class="line">SELECT e.ename,e.sal,d.dname FROM emp e</span><br><span class="line">INNER JOIN dept d</span><br><span class="line">ON e.deptno = d.deptno </span><br><span class="line">WHERE e.empno=7369;</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>外连接查询</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">left [outer] join 左外连接</span><br><span class="line">right [outer] join 右外连接</span><br></pre></td></tr></table></figure>
<p>如下查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#查询所有部门名称及该部门下员工的姓名</span><br><span class="line">select dname,ename from dept left join emp on dept.deptno = emp.deptno;</span><br><span class="line"></span><br><span class="line">#查询公司的员工姓名，及所在的部门名称</span><br><span class="line">SELECT ename,dname FROM emp LEFT JOIN dept ON dept.deptno = emp.deptno;</span><br><span class="line">SELECT ename,dname FROM dept RIGHT JOIN emp ON dept.deptno = emp.deptno;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="7">
<li><p>自连接查询</p>
<p>​    概念：表示表自己和自己连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#查询7369号员工的姓名，以及其上司的姓名</span><br><span class="line">select e1.ename 员工姓名,e2.ename 上司姓名 from emp e1 join emp e2 on e1.mgr = e2.empno;</span><br><span class="line"></span><br><span class="line">#注意起别名</span><br></pre></td></tr></table></figure>
</li>
<li><p>三表以上关联查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#查询7369号员工的姓名，身份证名称，部门名称</span><br><span class="line">SELECT ename,cardname,dname FROM emp </span><br><span class="line">LEFT JOIN empcard ON emp.`empno` = empcard.`empno`</span><br><span class="line">LEFT JOIN dept ON emp.`deptno` = dept.`deptno`</span><br><span class="line">WHERE emp.empno = 7369;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>三.子查询</strong></p>
<ol>
<li><p>概念：</p>
<p>一条完整的select语句之中包含其他select语句，这种查询方式称之为子查询</p>
<p>其中sub select语句可以出现的位置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.查询字段中出现</span><br><span class="line">2.where条件中</span><br><span class="line">3.having子句中</span><br></pre></td></tr></table></figure>
</li>
<li><p>用法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#查询工资大于JONES工资所有员工信息，其中JONES工资需要一条子查询</span><br><span class="line">步骤1: select * from emp where sal&gt;2975</span><br><span class="line">步骤2: select sal from emp where ename=&apos;JONES&apos;</span><br><span class="line">步骤3: select * from emp where sal&gt;(select sal from emp where ename=&apos;JONES&apos;);</span><br><span class="line"></span><br><span class="line">#查询与SCOTT同一个部门的员工</span><br><span class="line">步骤1：select * from emp where deptno = 20;</span><br><span class="line">步骤2: select deptno from emp where ename = &apos;SCOTT&apos;;</span><br><span class="line">步骤3: select * from emp where deptno = (select deptno from emp where ename = &apos;SCOTT&apos;);</span><br><span class="line">注意：子查询返回的结果集是一条，可以使用=，否则请使用in</span><br><span class="line"></span><br><span class="line">#工资高于30号部门所有人的员工信息</span><br><span class="line">SELECT * FROM emp WHERE sal&gt;(SELECT MAX(sal) FROM emp WHERE deptno = 30)</span><br><span class="line">SELECT * FROM emp WHERE sal &gt; ALL (SELECT sal FROM emp WHERE deptno=30)</span><br><span class="line"></span><br><span class="line">#工资高于30号部门任意一个人的员工信息（大于最小值）</span><br><span class="line">SELECT * FROM emp WHERE sal &gt; any (SELECT sal FROM emp WHERE deptno=30)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>四.视图View</strong></p>
<p>​     作用：对于复杂查询，把结果集固定下来，以便下一次使用。</p>
<p>​     语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create or replace view 视图名 as (复杂查询)</span><br></pre></td></tr></table></figure>
<p>​    代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#从视图中查询所有部门名称及该部门下员工的姓名</span><br><span class="line">create or replace view myview as (</span><br><span class="line">	select dname,ename from dept left join emp on dept.deptno = emp.deptno</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">#再次查询，从视图中查询</span><br><span class="line">SELECT * FROM myview;</span><br></pre></td></tr></table></figure>
<p><strong>五.了解SQL优化(尽量使用索引列为查询条件)</strong></p>
<p>1.应尽量避免在 where 子句中对字段进行 null 值判断，否则将导致引擎放弃使用索引而进行全表扫描。</p>
<p>2.对查询进行优化，应尽量避免全表扫描，首先应考虑在 where 及 order by 涉及的列上建立索引。 </p>
<p>3.应尽量避免在 where 子句中使用!=或&lt;&gt;操作符，否则将引擎放弃使用索引而进行全表扫描。 </p>
<p>4.应尽量避免在 where 子句中使用 or 来连接条件，否则将导致引擎放弃使用索引而进行全表扫描</p>
<p>5.in 和 not in 也要慎用，否则会导致全表扫描    </p>
<p>6.应尽量避免在 where 子句中对字段进行表达式操作</p>
<p>7.应尽量避免在where子句中对字段进行函数操作</p>
<p>8.很多时候用 exists 代替 in 是一个好的选择</p>
<p>9.尽量使用数字型字段</p>
<p>10.尽可能的使用 varchar/nvarchar 代替 char/nchar ，因为首先变长字段存储空间小，可以节省存储空间，其次对于查询来说，在一个相对较小的字段内搜索效率显然要高些</p>
<p>11.任何地方都不要使用 select <em> from t ，用具体的字段列表代替“</em>”，不要返回用不到的任何字段。 </p>
<p>12.尽量使用表变量来代替临时表。如果表变量包含大量数据，请注意索引非常有限（只有主键索引）。 </p>
<p>13.避免频繁创建和删除临时表，以减少系统表资源的消耗。 </p>
<p>14.在新建临时表时，如果一次性插入数据量很大，那么可以使用 select into 代替 create table，避免造成大量 log ，以提高速度；如果数据量不大，为了缓和系统表的资源，应先create table，然后insert。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Select * Into new_table_name from old_table_name</span><br><span class="line">MySQL不支持Select Into语句直接备份表结构和数据</span><br><span class="line">替代做法：</span><br><span class="line">Create table new_table_name (Select * from old_table_name)</span><br><span class="line">copy表结构及数据</span><br></pre></td></tr></table></figure>
<p><strong>六.作业</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line">数据库结构</span><br><span class="line">创建四张表 分别存储 学生信息 课程信息 分数 讲师信息表 存储相应数据</span><br><span class="line">学生信息表 Student</span><br><span class="line">字段名	字段类型	字段约束 / 含义</span><br><span class="line">Sno	Varchar(3)	Not null  / 学员编号</span><br><span class="line">Sname	Varchar(4)	Not null  / 学员姓名 </span><br><span class="line">Ssex	Varchar(2)	Not null  / 性别</span><br><span class="line">Sbirthday	Datetime	生日</span><br><span class="line">Classnum	Varchar(5)	班级号</span><br><span class="line"></span><br><span class="line">CREATE TABLE STUDENT</span><br><span class="line">(</span><br><span class="line">SNO VARCHAR(3) NOT NULL,</span><br><span class="line">SNAME VARCHAR(4) NOT NULL,</span><br><span class="line">SSEX VARCHAR(2) NOT NULL,</span><br><span class="line">SBIRTHDAY DATETIME,</span><br><span class="line">CLASS VARCHAR(5)</span><br><span class="line">)</span><br><span class="line">课程信息表 course</span><br><span class="line">字段名	字段类型	字段约束 / 含义</span><br><span class="line">Cno	Varchar(5)	Not null / 课程编号</span><br><span class="line">Cname	Varchar(10)	Not null / 课程名称</span><br><span class="line">Tno	Varchar(10)	Not null / 授课老师编号</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CREATE TABLE COURSE</span><br><span class="line">(CNO VARCHAR(5) NOT NULL,</span><br><span class="line">CNAME VARCHAR(10) NOT NULL,</span><br><span class="line">TNO VARCHAR(10) NOT NULL)</span><br><span class="line">成绩表score</span><br><span class="line">字段名	字段类型	字段约束 / 含义</span><br><span class="line">Sno	Varchar(3)	Not null  / 学员编号</span><br><span class="line">Cno	Varchar(5)	Not null  / 课程编号</span><br><span class="line">Degree	Double(3,1)	Not null  / 分数</span><br><span class="line"></span><br><span class="line">CREATE TABLE SCORE</span><br><span class="line">(SNO VARCHAR(3) NOT NULL,</span><br><span class="line">CNO VARCHAR(5) NOT NULL,</span><br><span class="line">DEGREE NUMERIC(10, 1) NOT NULL)</span><br><span class="line">讲师表teacher</span><br><span class="line">字段名	字段类型	字段约束 / 含义</span><br><span class="line">Tno	Varchar(3)	Not null  / 讲师编号</span><br><span class="line">Tname	Varchar(4)	Not null  / 讲师姓名</span><br><span class="line">Tsex	Varchar(2)	Not null  / 讲师性别</span><br><span class="line">Tbirthday	Datetime	Not null  / 出生日期</span><br><span class="line">Prof	Varchar(6)	等级</span><br><span class="line">Depart	Varchar(10)	所属院系</span><br><span class="line"></span><br><span class="line">CREATE TABLE TEACHER</span><br><span class="line">(TNO VARCHAR(3) NOT NULL,</span><br><span class="line">TNAME VARCHAR(4) NOT NULL, TSEX VARCHAR(2) NOT NULL,</span><br><span class="line">TBIRTHDAY DATETIME NOT NULL, PROF VARCHAR(6),</span><br><span class="line">DEPART VARCHAR(10) NOT NULL)</span><br><span class="line"></span><br><span class="line">向表中存储数据</span><br><span class="line">INSERT INTO STUDENT (SNO,SNAME,SSEX,SBIRTHDAY,CLASS) VALUES (108 ,&apos;曾华&apos; ,&apos;男&apos; ,1977-09-01,95033);</span><br><span class="line">INSERT INTO STUDENT (SNO,SNAME,SSEX,SBIRTHDAY,CLASS) VALUES (105 ,&apos;匡明&apos; ,&apos;男&apos; ,1975-10-02,95031);</span><br><span class="line">INSERT INTO STUDENT (SNO,SNAME,SSEX,SBIRTHDAY,CLASS) VALUES (107 ,&apos;王丽&apos; ,&apos;女&apos; ,1976-01-23,95033);</span><br><span class="line">INSERT INTO STUDENT (SNO,SNAME,SSEX,SBIRTHDAY,CLASS) VALUES (101 ,&apos;李军&apos; ,&apos;男&apos; ,1976-02-20,95033);</span><br><span class="line">INSERT INTO STUDENT (SNO,SNAME,SSEX,SBIRTHDAY,CLASS) VALUES (109 ,&apos;王芳&apos; ,&apos;女&apos; ,1975-02-10,95031);</span><br><span class="line">INSERT INTO STUDENT (SNO,SNAME,SSEX,SBIRTHDAY,CLASS) VALUES (103 ,&apos;陆君&apos; ,&apos;男&apos; ,1974-06-03,95031);</span><br><span class="line">GO</span><br><span class="line">INSERT INTO COURSE(CNO,CNAME,TNO)VALUES (&apos;3-105&apos; ,&apos;计算机导论&apos;,825);</span><br><span class="line">INSERT INTO COURSE(CNO,CNAME,TNO)VALUES (&apos;3-245&apos; ,&apos;操作系统&apos; ,804);</span><br><span class="line">INSERT INTO COURSE(CNO,CNAME,TNO)VALUES (&apos;6-166&apos; ,&apos;数据电路&apos; ,856);</span><br><span class="line">INSERT INTO COURSE(CNO,CNAME,TNO)VALUES (&apos;9-888&apos; ,&apos;高等数学&apos; ,100);</span><br><span class="line">GO</span><br><span class="line">INSERT INTO SCORE(SNO,CNO,DEGREE)VALUES (103,&apos;3-245&apos;,86);</span><br><span class="line">INSERT INTO SCORE(SNO,CNO,DEGREE)VALUES (105,&apos;3-245&apos;,75);</span><br><span class="line">INSERT INTO SCORE(SNO,CNO,DEGREE)VALUES (109,&apos;3-245&apos;,68);</span><br><span class="line">INSERT INTO SCORE(SNO,CNO,DEGREE)VALUES (103,&apos;3-105&apos;,92);</span><br><span class="line">INSERT INTO SCORE(SNO,CNO,DEGREE)VALUES (105,&apos;3-105&apos;,88);</span><br><span class="line">INSERT INTO SCORE(SNO,CNO,DEGREE)VALUES (109,&apos;3-105&apos;,76);</span><br><span class="line">INSERT INTO SCORE(SNO,CNO,DEGREE)VALUES (101,&apos;3-105&apos;,64);</span><br><span class="line">INSERT INTO SCORE(SNO,CNO,DEGREE)VALUES (107,&apos;3-105&apos;,91);</span><br><span class="line">INSERT INTO SCORE(SNO,CNO,DEGREE)VALUES (108,&apos;3-105&apos;,78);</span><br><span class="line">INSERT INTO SCORE(SNO,CNO,DEGREE)VALUES (101,&apos;6-166&apos;,85);</span><br><span class="line">INSERT INTO SCORE(SNO,CNO,DEGREE)VALUES (107,&apos;6-106&apos;,79);</span><br><span class="line">INSERT INTO SCORE(SNO,CNO,DEGREE)VALUES (108,&apos;6-166&apos;,81);</span><br><span class="line">GO</span><br><span class="line">INSERT INTO TEACHER(TNO,TNAME,TSEX,TBIRTHDAY,PROF,DEPART) </span><br><span class="line">VALUES (804,&apos;李诚&apos;,&apos;男&apos;,&apos;1958-12-02&apos;,&apos;副教授&apos;,&apos;计算机系&apos;);</span><br><span class="line">INSERT INTO TEACHER(TNO,TNAME,TSEX,TBIRTHDAY,PROF,DEPART) </span><br><span class="line">VALUES (856,&apos;张旭&apos;,&apos;男&apos;,&apos;1969-03-12&apos;,&apos;讲师&apos;,&apos;电子工程系&apos;);</span><br><span class="line">INSERT INTO TEACHER(TNO,TNAME,TSEX,TBIRTHDAY,PROF,DEPART)</span><br><span class="line">VALUES (825,&apos;王萍&apos;,&apos;女&apos;,&apos;1972-05-05&apos;,&apos;助教&apos;,&apos;计算机系&apos;);</span><br><span class="line">INSERT INTO TEACHER(TNO,TNAME,TSEX,TBIRTHDAY,PROF,DEPART) </span><br><span class="line">VALUES (831,&apos;刘冰&apos;,&apos;女&apos;,&apos;1977-08-14&apos;,&apos;助教&apos;,&apos;电子工程系&apos;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1、 查询Student表中的所有记录的Sname、Ssex和Class列。</span><br><span class="line">2、 查询教师所有的单位即不重复的Depart列。</span><br><span class="line">3、 查询Student表的所有记录。</span><br><span class="line">4、 查询Score表中成绩在60到80之间的所有记录。</span><br><span class="line">5、 查询Score表中成绩为85，86或88的记录。</span><br><span class="line">6、 查询Student表中“95031”班或性别为“女”的同学记录。</span><br><span class="line">7、 以Class降序查询Student表的所有记录。</span><br><span class="line">8、 以Cno升序、Degree降序查询Score表的所有记录。</span><br><span class="line">9、 查询“95031”班的学生人数。</span><br><span class="line">10、查询Score表中的最高分的学生学号和课程号。</span><br><span class="line">11、查询‘3-105’号课程的平均分。</span><br><span class="line">12、查询Score表中至少有5名学生选修的并以3开头的课程的平均分数。</span><br><span class="line">13、查询最低分大于70，最高分小于90的Sno列。</span><br><span class="line">14、查询所有学生的Sname、Cno和Degree列。</span><br><span class="line">15、查询所有学生的Sno、Cname和Degree列。</span><br><span class="line">16、查询所有学生的Sname、Cname和Degree列。</span><br><span class="line">17、查询“95033”班所选课程的平均分。</span><br><span class="line">18、假设使用如下命令建立了一个grade表：</span><br><span class="line">create table grade(low number(3,0),upp number(3),rank char(1));</span><br><span class="line">insert into grade values(90,100,’A’);</span><br><span class="line">insert into grade values(80,89,’B’);</span><br><span class="line">insert into grade values(70,79,’C’);</span><br><span class="line">insert into grade values(60,69,’D’);</span><br><span class="line">insert into grade values(0,59,’E’);</span><br><span class="line">commit;</span><br><span class="line">现查询所有同学的Sno、Cno和rank列。</span><br><span class="line">19、查询选修“3-105”课程的成绩高于“109”号同学成绩的所有同学的记录。</span><br><span class="line">20、查询score中选学一门以上课程的同学中分数为非最高分成绩的记录。</span><br><span class="line">21、查询成绩高于学号为“109”、课程号为“3-105”的成绩的所有记录。</span><br><span class="line">22、查询和学号为108的同学同年出生的所有学生的Sno、Sname和Sbirthday列。</span><br><span class="line">23、查询“张旭“教师任课的学生成绩。</span><br><span class="line">24、查询选修某课程的同学人数多于5人的教师姓名。</span><br><span class="line">25、查询95033班和95031班全体学生的记录。</span><br><span class="line">26、查询存在有85分以上成绩的课程Cno.</span><br><span class="line">27、查询出“计算机系“教师所教课程的成绩表。</span><br><span class="line">28、查询“计算机系”与“电子工程系“不同职称的教师的Tname和Prof。</span><br><span class="line">29、查询选修编号为“3-105“课程且成绩至少高于选修编号为“3-245”的同学的Cno、Sno和Degree,并按Degree从高到低次序排序。</span><br><span class="line">30、查询选修编号为“3-105”且成绩高于选修编号为“3-245”课程的同学的Cno、Sno和Degree.</span><br><span class="line">31、查询所有教师和同学的name、sex和birthday.</span><br><span class="line">32、查询所有“女”教师和“女”同学的name、sex和birthday.</span><br><span class="line">33、查询成绩比该课程平均成绩低的同学的成绩表。</span><br><span class="line">34、查询所有任课教师的Tname和Depart.</span><br><span class="line">35 查询所有未讲课的教师的Tname和Depart. </span><br><span class="line">36、查询至少有2名男生的班号。</span><br><span class="line">37、查询Student表中不姓“王”的同学记录。</span><br><span class="line">38、查询Student表中每个学生的姓名和年龄。</span><br><span class="line">39、查询Student表中最大和最小的Sbirthday日期值。</span><br><span class="line">40、以班号和年龄从大到小的顺序查询Student表中的全部记录。</span><br><span class="line">41、查询“男”教师及其所上的课程。</span><br><span class="line">42、查询最高分同学的Sno、Cno和Degree列。</span><br><span class="line">43、查询和“李军”同性别的所有同学的Sname.</span><br><span class="line">44、查询和“李军”同性别并同班的同学Sname.</span><br><span class="line">45、查询所有选修“计算机导论”课程的“男”同学的成绩表</span><br></pre></td></tr></table></figure>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2018/10/23/mysql数据库基础/"></a><a class="next" href="/2018/10/23/JDBC实现CRUD/"></a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://kongxianghe.top"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/10/24/spring boot 与spring cloud/">spring boot 与spring cloud</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/24/maven将外部jar添加到本地仓库/">maven将外部jar添加到本地仓库</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/24/docker的安装/">docker的安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/centos7安装mysql5.6教程/">centos7安装mysql5.6教程</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/数据库存入移动端表情出错/">数据库存入移动端表情出错</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/Java内存模型（JMM）/">Java内存模型（JMM）</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/进程，端口，服务/">进程，端口，服务</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/javascript前端脚本技术/">javascript前端脚本技术</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/CSS样式表/">CSS样式表</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/javaScript前端脚本技术二/">javaScript前端脚本技术二</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">BLOG.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>